<html>
<head>

<script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>
<script src="https://cdn.firebase.com/js/client/2.0.6/firebase.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<style type="text/css">

#first{
      cursor: pointer;
      position: absolute;
}

#second{
      position: fixed;
      right: 0px;
}
	
</style>
      <script>
            var url = "https://intense-inferno-7741.firebaseio.com";
            var moveClicks = 0;
            var start;
            var destination;
            var ref;
            var newRef;
      	var base = new Firebase(url);



      	function initialLoad() {

      		base.on("value",function(data){
                        $("#structure").html("");
      			var bar = data.val()
      			var a = 0;
      			data.forEach(function(i){
      				var b = 0
      				$("#structure").append("<div id='" + a + "' class='btn-primary'>" + i.key() + "</div>");
                              if(!i.hasChildren()){
                                    $("#" + a ).append("<div class='col-xs-offset-2 btn-success'>" + i.val() + "</div>");
                              }
      				i.forEach(function(c){
      					var e = 0
      					$("#" + a).append("<div id='" + b + "" + a + "b' class='col-xs-offset-1 btn-success'>" + c.key() + "</div>");
                                    if(!c.hasChildren()){
                                          $("#" + b + "" + a + "b").append("<div  class='col-xs-offset-2 btn-info'>" + c.val() + "</div>");
                                    }
      					c.forEach(function(d){
      						var g = 0
      						$("#" + b + "" + a + "b").append("<div id='" + e + "" + b + "" + a + "" + "c' class='col-xs-offset-2 btn-info'>" + d.key() + "</div>");
                                          if(!d.hasChildren()){
                                                $("#" + e + "" + b + "" + a + "" + "c").append("<div class='col-xs-offset-1 btn-warning'>" + d.val() + "</div>");
                                          }
                                          d.forEach(function(f){
                                                var h = 0;
                                                $("#" + e + "" + b + "" + a + "" + "c").append("<div id='" + g + "" + e + "" + b + "" + a + "" + "d' class='col-xs-offset-1 btn-warning'>" + f.key() + "</div>");
                                                if(!f.hasChildren()){
                                                      $("#" + g + "" + e + "" + b + "" + a + "" + "d").append("<div class='col-xs-offset-1 btn-danger'>" + f.val() + "</div>");
                                                }
                                                f.forEach(function(j){
                                                      var k = 0;
                                                      $("#" + g + "" + e + "" + b + "" + a + "" + "d").append("<div id='" + h + "" + g + "" + e + "" + b + "" + a + "" + "e' class='col-xs-offset-1 btn-danger'>" + j.key() + "</div>");
                                                      if(!j.hasChildren()){
                                                            $("#" + h + "" + g + "" + e + "" + b + "" + a + "" + "e").append("<div class='col-xs-offset-1 btn-primary'>" + j.val() + "</div>");
                                                      }
                                                      j.forEach(function(l){
                                                            var m = 0;
                                                            $("#" + h + "" + g + "" + e + "" + b + "" + a + "" + "e").append("<div id='" + k + h + "" + g + "" + e + "" + b + "" + a + "" + "f' class='col-xs-offset-1 btn-primary'>" + l.key() + "</div>");
                                                            if(!l.hasChildren()){
                                                                  $("#" + k + h + "" + g + "" + e + "" + b + "" + a + "" + "f").append("<div class='col-xs-offset-1 btn-success'>" + l.val() + "</div>");
                                                            }
                                                            l.forEach(function(n){
                                                                  var o = 0;
                                                                  $("#" + k + h + "" + g + "" + e + "" + b + "" + a + "" + "f").append("<div id='"+ m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g' class='col-xs-offset-1 btn-success'>" + n.key() + "</div>");
                                                                  if(!n.hasChildren()){
                                                                       $("#" + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g").append("<div class='col-xs-offset-1 btn-info'>" + n.val() + "</div>"); 
                                                                  }
                                                                  n.forEach(function(q){
                                                                        var p = 0
                                                                        $("#" + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g").append("<div id='" + o + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g' class='col-xs-offset-1 btn-info'>" + q.key() + "</div>"); 
                                                                        if(!q.hasChildren()){
                                                                              $("#" + o + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g").append("<div class='col-xs-offset-1 btn-warning'>" + q.val() + "</div>");
                                                                        }
                                                                        q.forEach(function(r){
                                                                              var s = 0;
                                                                              $("#" + o + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g").append("<div id='" + p + ""  + o + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g' class='col-xs-offset-1 btn-warning'>" + r.key() + "</div>");
                                                                              if(!r.hasChildren()){
                                                                                    $("#"  + p + ""  + o + m + ""  + k + "" + h + "" + g + "" + e + "" + b + "" + a + "" + "g").append("<div class='col-xs-offset-1 btn-danger'>" + r.val() + "</div>");
                                                                              }
                                                                              p++

                                                                        })
                                                                        o++
                                                                  })
                                                                  m++
                                                            })
                                                            k++
                                                      })
                                                      h++
                                                })
                                                g++
                                          })
      						e++
      					})
      					b++
      				})
					a++;
      			})
      		});

                  $('#structure').delegate('div', 'click', function() {
                        if(moveClicks == 1){
                              $("#message").text("Click move to finalize")
                        }

                        var selectedText = $(this).contents().filter( function() {
                              return this.nodeType === 3;
                        }).text(); 
                        
                        var loop = $(this);
                        var node;
                        var string = url;
                        var builder = new Array();
                        while(node != "structure"){
                              loop = loop.parent();
                              builder.push(loop.contents().filter( function() {
                              return this.nodeType === 3;
                        }).text())
                              node = loop.attr('id')
                        }
                        builder = builder.reverse();
                        for(i in builder){
                              string += "/" + builder[i];
                        }
                        string += "/" + selectedText;
                        string = string.replace("\t","");
                        string = string.replace("\n","")
                        string = string.replace("/\t","")
                        string = string.replace(" ","")

                        $("#selected").val(string);

                        return false;
                  });
                  $('#structure').delegate('div', 'dblclick', function() {

                        return false;
                  });

                  $("#moveButton").on("click",function(){
                        if(moveClicks == 0){
                              if($("#selected").val() == ""){
                                    $("#message").text("Nothing is selected")     
                              }else{
                                    $("#message").text("Select location to move reference")
                                    start = $("#selected").val();
                                    moveClicks = 1;
                              }
                        } else if(moveClicks == 1){
                              destination = $("#selected").val();
                              ref = new Firebase(start);
                              newRef = new Firebase(destination);



                              ref.once("value",function(data){
                                    var key = data.key();
                                    var collectedData = data.val();
                                    newRef.child(key).set(collectedData);
                                    ref.remove();
                              });

                              moveClicks = 0;
                              $("#message").html("")
                        }

                  })

                  $("#injectButton").on("click",function(){
                        $("#specialBox").html("");
                        $("#specialBox").append("<div class='form-group'><label class='col-xs-12'>JSON To Insert</label><input type='text' id='jsonInject' class='form-control col-xs-12'/>'")
                        $("#specialBox").append("<button id='jsonInjectButton' class=' btn btn-primary'>Inject</button><button id='jsonInjectCancelButton' class=' btn btn-primary'>Cancel</button></div>");
                  });

                  $("#jsonInjectButton").on("click",function(){
                        if($("#jsonInject").val() == ""){
                              $("#message").text("Select a reference")
                        }else if($("#selected").val() == ""){
                              $("#message").text("Enter a JSON String")
                        }else{
                              var jsonObject = JSON.parse($("#jsonInject").val());  
                        }
                        


                  });

                  $("#jsonInjectCancelButton").on("click",function(){
                        $("#specialBox").html("") 

                  });
      	}

      	

      </script>
</head>
<body onload="initialLoad()">
      <div id="first" class="col-xs-5">
		<div id="structure" class="row">
		</div>
      </div>
      <div id="second" class="col-xs-7">
            <nav class="navbar navbar-inverse">
                  <div class="container-fluid">
                      <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                          <span class="sr-only">Toggle navigation</span>
                          <span class="icon-bar"></span>
                          <span class="icon-bar"></span>
                          <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#">Firebase Derailer</a>
                      </div>
                      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                      </div><!-- /.navbar-collapse -->
                    </div>
            </nav>
            <div class="form-group">
            <label>Selected</label>
                  <input class="form-control" type="text" id="selected" readonly="readonly">
            </div>
            <div class="container-fuid">
                  <img src="swap.png" alt="Move" title="Move" id="moveButton" class="col-xs-1" />
                  <img src="add.png" alt="Add" title="Add" id="addButton" class="col-xs-1" />
                  <img src="edit.png" alt="Edit" title="Edit" id="editButton" class="col-xs-1" />
                  <img src="inject.png" alt="Inject" title="Inject" id="injectButton" class="col-xs-1" />
                  <div class="col-xs-12 text-center" id="message">
                  </div>
            </div>
            <div id="specialBox">
                  
            </div>
      </div>
	
</body>

</html>